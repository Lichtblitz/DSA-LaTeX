\documentclass{dsa}

\usepackage{shadowtext}
\usepackage{forloop}

\newcommand{\tabularTextInput}[1]{
    \dsaTextInput{#1}{.5\textwidth-4\tabcolsep-2cm}
}

\newcommand{\num}[2][\empty]{
    \ifthenelse{\equal{#1}{\empty}}{
        \raisebox{-0.35ex}{\textField[\ui{align={centered},textsize={12}}]{#2}{1.2cm}{1em}}%
    }{
        \raisebox{-0.35ex}{\textField[\ui{align={centered},textsize={12},bgcolor={#1}}]{#2}{1.2cm}{1.5em}}%
    }%
}
\newcommand{\dsaPropline}[2]{
    \small #1 & \num{#2modif} & \num{#2orig} & \cellcolor{white} \num{#2akt}%
}
\newcommand{\dsaExtProp}[3]{
    \small #1 \hfill \tiny\normalfont\bfseries #2 \hspace{3pt} & \num{#3modif} & \num{#3orig} & \cellcolor{white}\num{#3akt}
}
\newcommand{\dsaExtPropline}[3]{
    \dsaExtProp{#1}{#2}{#3} & \num{#3bought} & \num{#3perm}%
}
\newcommand{\smallnum}[1]{
    \hspace{-6pt}\raisebox{-0.35ex}{\textField[\ui{align={centered},textsize={12}}\Ff{\FfReadOnly}]{#1}{0.8cm}{1em}}\hspace{-4pt}%
}
\newcommand{\smalltext}[3][\empty]{%
    \ifthenelse{\equal{#1}{\empty}}{%
        \textField[\textSize{8}]{#2}{#3}{10pt}%
    }{%
        \textField[\ui{align={#1}}\textSize{8}]{#2}{#3}{10pt}%
    }%
}

\makeatletter
\newcommand{\roystreqtest}[2]{%
  \ifnum\pdfstrcmp{#1}{#2}=\z@
    \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi}
\newcommand*{\shifttext}[2]{%
  \settowidth{\@tempdima}{#2}%
  \makebox[\@tempdima]{\hspace*{#1}#2}%
}
\makeatother

\begin{document}

\setlength{\fboxsep}{6pt}

\begin{dsaCharacterSheet}
\vspace*{10pt}
\renewcommand{\arraystretch}{1.25}
\begin{dsaSheetBox}
    
    \vspace{8pt}
    \begin{center}
        \Huge \shadowtext{Heldendokument}
    \end{center}
    \begin{tabular}{p{2cm}p{\dimexpr.5\textwidth-4\tabcolsep-2cm}p{2cm}p{\dimexpr.5\textwidth-4\tabcolsep-2cm}}
        \textmansontt{Name} & \tabularTextInput{Name} & \textmansontt{GP-Basis} & \tabularTextInput{GP-Basis} \\ \hline
        \textmansontt{Rasse} & \tabularTextInput{Rasse} & \textmansontt{Kultur} & \tabularTextInput{Kultur} \\ \hline
        \textmansontt{Profession} & \multicolumn{3}{l}{\dsaTextInput{Profession}{\textwidth-4\tabcolsep-2cm}}
    \end{tabular}
\end{dsaSheetBox}

\vspace{-8pt}
\renewcommand{\tabularTextInput}[1]{
    \dsaTextInput{#1}{\textwidth-3\tabcolsep-2.2cm}
}
\begin{multicols}{2}
\begin{dsaSheetBox}[.5\textwidth-.5\columnsep]
    \begin{tabular}{p{2.2cm}p{\dimexpr\textwidth-4\tabcolsep-2.2cm}}
        \textmansontt{Geschlecht} & \tabularTextInput{Geschlecht} \\ \hline
        \textmansontt{Geburtstag} & \tabularTextInput{Geburtstag} \\ \hline
        \textmansontt{Größe} & \tabularTextInput{Groesse} \\ \hline
        \textmansontt{Gewicht} & \tabularTextInput{Gewicht} \\ \hline
        \textmansontt{Haarfarbe} & \tabularTextInput{Haarfarbe} \\ \hline
        \textmansontt{Augenfarbe} & \tabularTextInput{Augenfarbe}
    \end{tabular}
\end{dsaSheetBox}%

\columnbreak%
\begin{dsaSheetBox}[.5\textwidth-.5\columnsep]
    \begin{tabular}{p{2.2cm}p{\dimexpr\textwidth-4\tabcolsep-2.2cm}}
        \textmansontt{Stand} & \tabularTextInput{Stand} \\ \hline
        \textmansontt{Sozialstatus} & \tabularTextInput{Sozialstatus} \\ \hline
        \textmansontt{Titel} & \tabularTextInput{Titel1} \\ \hline
        \multicolumn{2}{p{\dimexpr\textwidth-4\tabcolsep}}{\dsaTextInput{Titel2}{\textwidth-\tabcolsep}} \\ \hline
        \multicolumn{2}{p{\dimexpr\textwidth-4\tabcolsep}}{\dsaTextInput{Titel3}{\textwidth-\tabcolsep}} \\ \hline
        \multicolumn{2}{p{\dimexpr\textwidth-4\tabcolsep}}{\dsaTextInput{Titel4}{\textwidth-\tabcolsep}}
    \end{tabular}
\end{dsaSheetBox}%
\end{multicols}
\vspace{-12pt}

\begin{dsaSheetBox}[\textwidth]
    \begin{tabular}{p{2.2cm}p{\dimexpr\textwidth-4\tabcolsep-2.2cm}}
        \textmansontt{Aussehen} & \tabularTextInput{Aussehen1} \\ \hline
        \multicolumn{2}{p{\dimexpr\textwidth-4\tabcolsep}}{\dsaTextInput{Aussehen2}{\textwidth-\tabcolsep}} \\ \hline
        \multicolumn{2}{p{\dimexpr\textwidth-4\tabcolsep}}{\dsaTextInput{Aussehen3}{\textwidth-\tabcolsep}}
    \end{tabular}
\end{dsaSheetBox}%

\vspace{-4pt}
\begin{multicols}{2}
\begin{center}
    \huge \shadowtext{Vorteile}%
\end{center}%
\vspace{-12pt}%
\begin{dsaSheetBox}[.5\textwidth-.5\columnsep]
    \begin{tabular}{p{\dimexpr\textwidth-2\tabcolsep}}
        \dsaTextInput{Vorteile1}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Vorteile2}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Vorteile3}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Vorteile4}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Vorteile5}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Vorteile6}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Vorteile7}{\textwidth-\tabcolsep}
    \end{tabular}
\end{dsaSheetBox}

\columnbreak
\begin{center}
    \huge \shadowtext{Nachteile}%
\end{center}%
\vspace{-12pt}%
\begin{dsaSheetBox}[.5\textwidth-.5\columnsep]
    \begin{tabular}{p{\dimexpr\textwidth-2\tabcolsep}}
        \dsaTextInput{Nachteile1}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Nachteile2}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Nachteile3}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Nachteile4}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Nachteile5}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Nachteile6}{\textwidth-\tabcolsep} \\ \hline
        \dsaTextInput{Nachteile7}{\textwidth-\tabcolsep}
    \end{tabular}
\end{dsaSheetBox}
\end{multicols}

\vspace{-24pt}
\begin{center}
    \huge \shadowtext{Eigenschaften \& Basiswerte}
\end{center}

\vspace{-8pt}
\begin{dsaSheetBox}[2\fboxsep + 6.72cm]
    \setlength{\tabcolsep}{0pt}
    \begin{tabu}{p{3.1cm}|p{1.2cm}|p{1.2cm}!{\vrule width 4\arrayrulewidth}p{1.2cm}}
        \dsaRow{\scriptsize}{\tiny\normalfont\bfseries\centering}{ & Modifikator & Start & Aktuell} \Xhline{2\arrayrulewidth}
        \dsaPropline{Mut}{MU} \\ \hline
        \dsaPropline{Klugkeit}{KL} \\ \hline
        \dsaPropline{Intuition}{IN} \\ \hline
        \dsaPropline{Charisma}{CH} \\ \hline
        \dsaPropline{Fingerfertigkeit}{FF} \\ \hline
        \dsaPropline{Gewandtheit}{GE} \\ \hline
        \dsaPropline{Konstitution}{KO} \\ \hline
        \dsaPropline{Körperkraft}{KK} \\ \Xhline{2\arrayrulewidth}
        \dsaPropline{Geschwindigkeit}{GS}
   \end{tabu}%

   \vspace{1pt}
\end{dsaSheetBox}
\begin{dsaSheetBox}[2\fboxsep + 11.2cm]
    \setlength{\tabcolsep}{0pt}
    \begin{tabu}{p{5.1cm}|p{1.2cm}|p{1.2cm}!{\vrule width 4\arrayrulewidth}p{1.2cm}!{\vrule width 4\arrayrulewidth}p{1.2cm}|p{1.2cm}}
        \dsaRow{\scriptsize}{\tiny\normalfont\bfseries\centering}{ & Modifikator & Start & Aktuell & Zugekauft & Permanent} \Xhline{2\arrayrulewidth}
        \dsaExtPropline{Lebenspunkte}{(KO+KO+KK)/2}{LE} \\ \hline
        \dsaExtPropline{Ausdauer}{(MU+KO+GE)/2}{AU} \\ \hline
        \dsaExtPropline{Astralenergie}{(MU+IN+CH)/2}{AE} \\ \hline
        \dsaExtPropline{Karmaenergie}{}{KE} \\ \hline
        \dsaExtPropline{Magieresistenz}{(MU+KL+KO)/5}{MR} \\ \hline
        \dsaExtProp{INI-Basiswert}{(MU+MU+IN+GE)/5}{INI} & \multicolumn{2}{l}{
            \hspace{5pt}\begin{minipage}{2.4cm}\tiny\normalfont
                \vspace{-1pt}
                \checkBox[\ui{bgcolor={1 1 1}}\symbolchoice{star}]{Kampfreflexe}{0.13cm}{0.09cm}{Kampfreflexe} \raisebox{0.45ex}{Kampfreflexe (INI+4)} \\[1.5pt]
                \checkBox[\ui{bgcolor={1 1 1}}\symbolchoice{star}]{Kampfgespür}{0.13cm}{0.09cm}{Kampfgespuer} \raisebox{0.45ex}{Kampfgespür (INI+2)}
            \end{minipage}
        } \\ \hline
        \dsaExtProp{AT-Basiswert}{(MU+GE+KK)/5}{AT} & \multicolumn{2}{c}{\scriptsize \raisebox{-0.45ex}{Wundschwelle}} \\ \cline{1-4}
        \dsaExtProp{PA-Basiswert}{(IN+GE+KK)/5}{PA} & \multicolumn{2}{c}{\tiny\normalfont \raisebox{2ex}{(KO/2)+Modifikator}} \\ \cline{1-4}
        \dsaExtProp{FK-Basiswert}{(IN+FF+KK)/5}{FK} & \multicolumn{2}{c}{\num[1 1 1]{WS}}
    \end{tabu}
\end{dsaSheetBox}

\vspace{-16pt}
\begin{center}
    \huge \shadowtext{Abenteuerpunkte}
\end{center}
\vspace{-8pt}

\begin{dsaSheetBox}[\textwidth]
    \Large

    \vspace{-3pt}
    \begin{tabular}{p{2.5cm}p{2.5cm}p{2.7cm}p{2.5cm}p{2.5cm}p{2.5cm}}
        Gesamt: & \dsaTextInput{AP-Gesamt}{2.5cm} & Eingesetzt: & \dsaTextInput{AP-Eingesetzt}{2.5cm} & Guthaben: & \dsaTextInput{AP-Guthaben}{2.5cm}
    \end{tabular}

    \vspace{-3pt}
\end{dsaSheetBox}

\end{dsaCharacterSheet}

\begin{dsaCharacterSheet}

\vspace*{8pt}
\begin{dsaSheetBox}[\textwidth]
    \vspace{1pt}
    \begin{tabular}{llllllllllllllllll}
        MU: & \smallnum{MUakt} & KL: & \smallnum{KLakt} & IN: & \smallnum{INakt} & CH: & \smallnum{CHakt} & FF: & \smallnum{FFakt} & GE: & \smallnum{GEakt} & KO: & \smallnum{KOakt} & KK: & \smallnum{KKakt} & BE: & \smallnum{BE}
    \end{tabular}
    \vspace{-1pt}
\end{dsaSheetBox}

\vspace{-16pt}
\begin{center}
    \huge \shadowtext{Sonderfertigkeiten \& Talente}%
\end{center}%
\vspace{-8pt}

\newcounter{ct}

\begin{dsaSheetBox}[\textwidth]

    \renewcommand{\arraystretch}{1}
    \setlength{\tabcolsep}{1pt}
    \normalfont\bfseries
    \newcommand{\Sonderfertigkeiten}[1]{
        \raisebox{0.45ex}{\textmansontt{\Large Sonderfertigkeiten (außer Kampf)}}

        \tiny
        \begin{tabular}{p{.5\textwidth-.5\columnsep-.5\fboxsep}} \hline
            \forloop{ct}{0}{\value{ct} < #1}%
            {%
              \smalltext{Sonderfertigkeiten-Allgemein\thect}{.5\textwidth-.5\columnsep-.5\fboxsep} \\ \hline
            }
        \end{tabular}
    }
    \newcommand{\Kampftechniken}[1]{
        \tiny
        \ifcase\MSpalte\relax
            \begin{tabular}{p{0.2cm}|p{4.6cm}|p{0.4cm}|p{1cm}|p{0.7cm}!{\footnotesize •}p{0.7cm}|p{0.8cm}}
                \multicolumn{3}{l|}{\Large \raisebox{0.35ex}{\textmansontt{Kampftechniken}}} & \footnotesize\centering BE & \footnotesize\centering AT & \footnotesize\centering PA & \footnotesize\hspace{0.5pt} TaW
                \forloop{ct}{0}{\value{ct} < #1}%
                {%
                    \\ \hline
                    \checkBox[\symbolchoice{star}\BC{}]{Kampftechniken-SE\thect}{0.2cm}{0.2cm} &
                    \smalltext{Kampftechniken-Name\thect}{4.6cm} &
                    \smalltext[centered]{Kampftechniken-Spalte\thect}{0.4cm} &
                    \smalltext[centered]{Kampftechniken-BE\thect}{1cm} &
                    \smalltext[centered]{Kampftechniken-AT\thect}{0.7cm} &
                    \smalltext[centered]{Kampftechniken-PA\thect}{0.7cm} &
                    \smalltext[centered]{Kampftechniken-TaW\thect}{0.8cm}%
                } \\ \hline
            \end{tabular}
        \else
            \begin{tabular}{p{0.2cm}|p{4.15cm}|p{0.4cm}|p{1cm}|p{0.7cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.7cm}|p{0.8cm}|p{0.4cm}}
                \multicolumn{3}{l|}{\Large \raisebox{0.35ex}{\textmansontt{Kampftechniken}}} & \footnotesize\centering BE & \footnotesize\centering AT & \footnotesize\centering PA & \footnotesize\hspace{0.5pt} TaW & \footnotesize\hspace{1pt} M
                \forloop{ct}{0}{\value{ct} < #1}%
                {%
                    \\ \hline
                    \checkBox[\symbolchoice{star}\BC{}]{Kampftechniken-SE\thect}{0.2cm}{0.2cm} &
                    \smalltext{Kampftechniken-Name\thect}{4.15cm} &
                    \smalltext[centered]{Kampftechniken-Spalte\thect}{0.4cm} &
                    \smalltext[centered]{Kampftechniken-BE\thect}{1cm} &
                    \smalltext[centered]{Kampftechniken-AT\thect}{0.7cm} &
                    \smalltext[centered]{Kampftechniken-PA\thect}{0.7cm} &
                    \smalltext[centered]{Kampftechniken-TaW\thect}{0.8cm} &
                    \shifttext{-0.1cm}{\smalltext[centered]{Kampftechniken-M\thect}{0.6cm}}%
                } \\ \hline
            \end{tabular}
        \fi

        \vspace{8pt}
    }

    \newcommand{\SprachenSchriften}[1]{
        \begin{tabular}{p{0.2cm}|p{6.85cm}|p{1cm}|p{0.8cm}}
            \multicolumn{2}{l|}{\Large \raisebox{0.35ex}{\textmansontt{Sprachen \& Schriften}}} &
            \footnotesize\centering Komp. & \footnotesize\hspace{0.5pt} TaW
            \forloop{ct}{0}{\value{ct} < #1}{%
                \\ \hline
                \checkBox[\symbolchoice{star}\BC{}]{Kampftechniken-SE\thect}{0.2cm}{0.2cm} &
                \smalltext{Sprachen-Name\thect}{6.85cm} &
                \smalltext[centered]{Sprachen-Komp\thect}{1cm} &
                \smalltext[centered]{Sprachen-TaW\thect}{0.8cm}%
            } \\ \hline
        \end{tabular}

        \vspace{8pt}
    }

    \newcommand{\Talentliste}[5]{% #1=Feldname-Präfix, #2=Anzeigename, #3=Anzahl, #4=Mirakel?, #5=BE?
        \tiny
        \ifcase#4\relax
            \ifcase#5\relax
                \begin{tabular}{p{0.2cm}|p{5.8cm}|p{0.5cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.5cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.5cm}|p{0.8cm}}
                    \multicolumn{5}{l|}{\Large \raisebox{0.35ex}{\textmansontt{#2}}} & \footnotesize\hspace{0.5pt} TaW
                    \forloop{ct}{0}{\value{ct} < #3}{%
                        \\ \hline
                        \checkBox[\symbolchoice{star}\BC{}]{#1-SE\thect}{0.2cm}{0.2cm} &
                        \smalltext{#1-Name\thect}{5.8cm} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft1-\thect}{0.7cm}} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft2-\thect}{0.7cm}} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft3-\thect}{0.7cm}} &
                        \smalltext[centered]{#1-TaW\thect}{0.8cm}%
                    } \\ \hline
                \end{tabular}
            \else
                \begin{tabular}{p{0.2cm}|p{4.7cm}|p{0.5cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.5cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.5cm}|p{1.0cm}|p{0.8cm}|p{0.4cm}}
                    \multicolumn{5}{l|}{\Large \raisebox{0.35ex}{\textmansontt{#2}}} & \footnotesize\centering BE & \footnotesize\hspace{0.5pt} TaW
                    \forloop{ct}{0}{\value{ct} < #3}{%
                        \\ \hline
                        \checkBox[\symbolchoice{star}\BC{}]{#1-SE\thect}{0.2cm}{0.2cm} &
                        \smalltext{#1-Name\thect}{4.7cm} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft1-\thect}{0.7cm}} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft2-\thect}{0.7cm}} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft3-\thect}{0.7cm}} &
                        \smalltext[centered]{#1-BE\thect}{1cm} &
                        \smalltext[centered]{#1-TaW\thect}{0.8cm}%
                    } \\ \hline
                \end{tabular}
            \fi
        \else
            \ifcase#5
                \begin{tabular}{p{0.2cm}|p{5.4cm}|p{0.5cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.5cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.5cm}|p{0.8cm}|p{0.4cm}}
                    \multicolumn{5}{l|}{\Large \raisebox{0.35ex}{\textmansontt{#2}}} & \footnotesize\hspace{0.5pt} TaW & \footnotesize\hspace{1pt} M
                    \forloop{ct}{0}{\value{ct} < #3}{%
                        \\ \hline
                        \checkBox[\symbolchoice{star}\BC{}]{#1-SE\thect}{0.2cm}{0.2cm} &
                        \smalltext{#1-Name\thect}{5.4cm} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft1-\thect}{0.7cm}} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft2-\thect}{0.7cm}} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft3-\thect}{0.7cm}} &
                        \smalltext[centered]{#1-TaW\thect}{0.8cm} &
                        \shifttext{-0.1cm}{\smalltext[centered]{#1-M\thect}{0.6cm}}%
                    } \\ \hline
                \end{tabular}
            \else
                \begin{tabular}{p{0.2cm}|p{4.3cm}|p{0.5cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.5cm}!{\footnotesize\raisebox{0.35ex}{•}}p{0.5cm}|p{1.0cm}|p{0.8cm}|p{0.4cm}}
                    \multicolumn{5}{l|}{\Large \raisebox{0.35ex}{\textmansontt{#2}}} & \footnotesize\centering BE & \footnotesize\hspace{0.5pt} TaW & \footnotesize\hspace{1pt} M
                    \forloop{ct}{0}{\value{ct} < #3}{%
                        \\ \hline
                        \checkBox[\symbolchoice{star}\BC{}]{#1-SE\thect}{0.2cm}{0.2cm} &
                        \smalltext{#1-Name\thect}{4.3cm} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft1-\thect}{0.7cm}} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft2-\thect}{0.7cm}} &
                        \shifttext{-0.225cm}{\smalltext[centered]{#1-Eigenschaft3-\thect}{0.7cm}} &
                        \smalltext[centered]{#1-BE\thect}{1cm} &
                        \smalltext[centered]{#1-TaW\thect}{0.8cm} &
                        \shifttext{-0.1cm}{\smalltext[centered]{#1-M\thect}{0.6cm}}%
                    } \\ \hline
                \end{tabular}
            \fi
        \fi

        \vspace{8pt}
    }
    \newcommand{\Gaben}[2][Gaben]{\Talentliste{Gaben}{#1}{#2}{0}{0}}
    \newcommand{\KoerperlicheTalente}[1]{\Talentliste{Koerper}{Körperliche Talente}{#1}{\MSpalte}{1}}
    \newcommand{\GesellschaftlicheTalente}[1]{\Talentliste{Gesellschaft}{Gesellschaftliche Talente}{#1}{\MSpalte}{0}}
    \newcommand{\NaturTalente}[1]{\Talentliste{Natur}{Naturtalente}{#1}{\MSpalte}{0}}
    \newcommand{\WissensTalente}[1]{\Talentliste{Wissen}{Wissenstalente}{#1}{\MSpalte}{0}}
    \newcommand{\HandwerklicheTalente}[1]{\Talentliste{Handwerk}{Handwerkliche Talente}{#1}{\MSpalte}{0}}

    \input{talentbogen.tex}
    
    \setlength{\columnseprule}{1pt}
    \setlength{\columnsep}{4pt}
    \begin{multicols}{2}
        \TalenteLinks

    \columnbreak
        \TalenteRechts
    \end{multicols}
\end{dsaSheetBox}

%
\end{dsaCharacterSheet}

\end{document}